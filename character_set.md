# Python Character Set Issue

python字符编码主要涉及两个场景

- python脚本文件在硬盘的编码方式（和任意一个txt在硬盘的编码方式问题类似）
- python解释器运行python脚本时在内存中存储字符型数据的编码方式

---

##  1. Character Encoding Development

​		计算机中的一位只能表示0或1，但通过一个字节（8位）可以表示256（$2^8$）个不同的含义，最开始计算机由美国发明，只用表示英文字母，阿拉伯数字，以及一些键盘上的常用的符号，所以1个字节完全够用，最开始的字符与数字的映射关系为**ASCII**编码（仅表示128个字符）与**Latin1**编码（表示256个字符，向下兼容**ASCII**码）。

​		随着计算机的发展，各国的使用，比如中国人想要写出中文，日本人想要写出日文，因此一个字节不能表示所有字符，中国人编制了数字与中文的映射关系表，使用两个字节就能表示所有中文（**GB2312**，**GBK**，向下兼容ASCII码，即0-255对应的符号与**ASCII**码表是一致的），日本人也编制了自己的**Shift_JIS**编码，出现的问题是比如1000对应的符号在**GBK**中与在Shift_JIS中是不一样的。所以如果你用一台中文编码的计算机写了一篇文章存储在计算机中是二级制文件，再把这个二进制的文件用韩文编码的计算机打开就会出现乱码的问题，所以如果一个文件是**GBK**编码所形成的二进制，你需要以**GBK**的编码方式打开这个文件。

​		因此发展的最后就是出现一张统一的数字与符号的映射表（**Unicode**），一般用两个字节，即包括中文符号，也包括日文符号，仅可能包括世界上所有语言的符号。（注意，比如中文中有"大"这个符号，日文中也有"大"这个符号，他们在**Unicode**中对应的是同一个数字，但"大"这个符号在**GBK**与**SHIFT_JIS**中却对应的数字却是不同的）。

​		并且**Unicode**表中不仅包含了在**Unicode**中的符号与数字的对应关系，还统计了该符号在各国编码表中对应的数字分别是多少，该作用就是，对应由于过去的历史中遗留了很多**GBK**编码的文件，能使GBK编码的文件转变为**Unicode**编码的文件，能使**SHIFT_JIS**编码的文件转变为**Unicode**编码的文件（即是我们打开计算机看到的符号没有变，但底层的二进制表示却变化了），甚至我们可以以**Unicode**为媒介，实现**GBK**与**SHIFT_JIS**编码的转换。

![image-20230305171820000](https://ssz29.oss-cn-chengdu.aliyuncs.com/img_for_md/image-20230305171820000.png)

​		但**Unicode**存在一个问题，对于通篇都是英文的文本来说，**Unicode**的方式存储到硬盘中无疑是多了一倍的存储空间，于是产生了**UTF-8**（可变长，全称**Unicode Transformation Format**），对英文字符只用1Bytes表示，对中文字符用3Bytes，对其他生僻字用更多的Bytes去存。具体是如何实现的，就不在此展开。所以现在我们一般看到的文件是**GBK**编码，或者UTF-8编码，要实现两种编码的转换，需要以**Unicode**为中间媒介。但是当把一个文件从硬盘读到内存中，在内存中现在都是统一使用**Unicode**表示，因为不管以各种方式编码存储的文件，都可以转换为**Unicode**，但会稍微浪费内存空间。



## 2. Python Character Set Issue

​		python要运行一个python脚本（一个文本文件，但书写的规范符合python的语法，一般我们命名以py为后缀）的步骤是：

1. 解释器将该文本文件加载到内存中（涉及到以何种编码方式加载硬盘上的文件，与一个记事本打开一个文件是一致的）
2. python解释器去执行在内存中的这段文本，其中可能涉及到字符串数据类型的存储

​		在第一步中，类似于一个记事本打开一个硬盘上的文件，文件在硬盘上是以什么方式编码，我们就需要以什么编码方式打开他，但是问题是我们应该怎么告诉解释以什么编码方式将硬盘上的文件加载到内存中？

​		解释器的版本不同会有所区别，python2的解释器默认会以ASCII码的方式将文件加载到内存中，python3的解释器默认会以UTF-8编码的方式将文件加载到内存中，注意加载到内存中的文字会转换为以Unicode编码的。那么如果你的文件是以GBK方式编码的该怎么办？解决办法是在文件的第一行加上`#coding:gbk`。如果你使用pycharm用GBK编码的方式打开一个GBK文件编码的文件，就不会乱码，这时候点击运行脚本就算没有头部的说明也不会出现错误，因为pycharm帮你完成了这一步，并不是省去了这一步。

​		在第二步执行代码的过程中，可能生成了一个字符串型的变量，需要开辟一段内存空间，该字符串会以何种编码方式编码存储到内存空间中也涉及到了字符编码的问题。

​		在Python2，字符串有两种类型，Str与Unicode，当python解释器执行到产生字符串的代码时（例如x='大'），会申请新的内存地址，然后将'大'编码成文件开头指定的编码格式。当python解释器执行到产生字符串的代码时（例如s=u'大'），会申请新的内存地址，然后将'大'以unicode的格式存放到新的内存空间中。在python2中将一个字符变量打印到终端时，会将内存中的东西，以终端的编码方式查看（pycharm终端utf-8，windows终端为gbk），所以你将一个gbk的东西打印到pycharm终端中会乱码。但如果一个字符在内存中是unicode，无论终端的编码方式如何，都能正常打印。

​		在python3中，也有两种字符串类型，str和bytes，str即是unicode，正常创建一个字符串变量，是在开辟的内存空间中以unicode的编码方式编码的，bytes即是以b开头的二进制字符串，可以通过x.encode('gbk') 或 x.encode('utf-8')获得，就是将unicode转换为相应编码格式编码。

